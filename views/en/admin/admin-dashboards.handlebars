<br>
<div class="container">
    <div class="title-and-help-wrapper">
        <h3 id="category-title">{{category}}</h3>
        <a class="btn-floating btn-small waves-effect waves-light green" href="/en/admin/{{category}}/add"><i class="material-icons">add</i></a>
        <a id="delete-{{category}}" class="btn-floating btn-small waves-effect waves-light red disabled"><i class="material-icons">delete</i></a>
        <a id="display-help" class="btn-floating btn-small waves-effect waves-light blue"><i class="material-icons">help_outline</i></a>
    </div>
    <table class="bordered highlight responsive-table">
        <thead>
            <tr>
                <th class="less-bottom-padding"><input type="checkbox" id="select-all" class="filled-in" /><label for="select-all"></label></th>
                <th>#</th>
                <th>Title</th>
                {{#if data.1.category}}
                    <th>Category</th>
                {{/if}}
                <th>Date Created</th>
                <th>Last Updated</th>
            </tr>
        </thead>
        <tbody>
            {{#each data}}
            <tr id="row-{{_id}}">
                <td class="less-bottom-padding checkbox-td"><input type="checkbox" id="delete-{{category}}-{{@index}}" class="potential-delete filled-in" name="{{_id}}" /><label for="delete-{{category}}-{{@index}}"></label></td>
                <td>{{@index}}</td>
                <td><a class="truncate" href="{{../category}}/edit?id={{_id}}">{{title}}</a></td>
                {{#if category}}
                    <td>{{category}}</td>
                {{/if}}
                <td>12/15/2016</td>
                <td>12/15/2016</td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<!-- Modal Structure 2 -->
<div id="delete-recipes-modal" class="modal">
    <div class="modal-content">
        <h4>Are you sure you want to delete this recipe?</h4>
        <p>
            If you decide to delete this recipe it will permanently be lost.
            Are you sure you want to continue?
            <br>
            <br>
            <span class="grey-text">
                <b>Note</b>: deleting the recipe will <b>not</b> delete the photos associated with the recipe.
                You must visit the gallery and delete them from there.
            </span>
        </p>
    </div>
    <div class="modal-footer">
        <a id="confirm-delete-btn" href="" class="modal-action modal-close waves-effect btn-flat">Yes, delete selected.</a>
        <a id="close-modal-2-btn" href="" class="modal-action modal-close waves-effect btn-flat">No</a>
    </div>
</div>

<style>
    #category-title::first-letter {
        text-transform: uppercase;
    }

    .less-bottom-padding {
        padding-bottom: 7px;
    }

    .title-and-help-wrapper > * {
        display: inline-block;
    }

    .title-and-help-wrapper > a {
        margin-left: 15px;
        margin-bottom: 16.352px;
    }

    tbody > tr > td:first-child {
        width: 30px;
    }

    /* small */
    @media (min-width: 768px) {
        .title-and-help-wrapper > a {
            margin-left: 20px;
        }
    }
</style>

<script>
    $(document).ready(function() {
        $('.modal').modal();

        $('#select-all').click(function() {
            var checkBoxes = $('tbody > tr > td > input[type=checkbox]');
            checkBoxes.prop('checked', $(this).prop('checked'));
            DeleteButtonClickable();
        });

        $('#display-help').click(function() {
            // TODO: display modal to help laura with navigating admin buttons/table
            $('#help-modal').modal('open');
        });

        $('#delete-{{category}}').click(function() {
            $('#delete-recipes-modal').modal('open');
        });

        $('#confirm-delete-btn').click(function(e) {
            e.preventDefault();
            var selected = [];
            $('.checkbox-td > input:checked').each(function() {
                selected.push($(this).attr('name'));
            });

            if(selected.length === 1) {
                DeleteSingleRecipe(selected);
            } else {
                DeleteMultipleRecipes(selected);
            }
        });

        $('#close-modal-2-btn').click(function(e) {
            e.preventDefault();
            $('#delete-recipes-modal').modal('close');
        });

        $('.potential-delete').click(DeleteButtonClickable);
    });

    function DeleteButtonClickable() {
        $('#delete-{{category}}').toggleClass('disabled', $('tbody > tr > td > input[type=checkbox]:checked').length <= 0);
    }

    function DeleteRows(selected) {
        selected.forEach(function(id) {
            var row = $('#row-'+id);
            row.children('td, th')
                .animate({padding: 0})
                .wrapInner('<div />')
                .children()
                .slideUp(function() {
                    $(this).closest('tr').remove();
                });
        });
    }

    function DeleteSingleRecipe(selected) {
        // deletes single recipe
        var recipe = selected[0];
        $.ajax({
            method: 'DELETE',
            url: '/admin/recipes' + '?id=' + recipe,
        }).done(function(response) {
            DeleteRows(selected);
            Materialize.toast('Successfully deleted recipe', 5000, 'green');
        }).fail(function(jqXHR, textStatus, errorThrown) {
            var statusCode = (jqXHR.status.toString()).split('');
            var statusText = jqXHR.statusText;
            if(statusCode[0] === 5 || statusText.match(/Internal Server Error/)) {
                // server-side error - contact pablo
                Materialize.toast('Server-side Error - Was not able to delete. Contact Pablo if problem persists.', 5000, 'red');
            } else if(statusCode[0] === 4 || statusText.match(/Bad Request/)) {
                // client-side error - try again in a few moments
                Materialize.toast('Failed to Delete Recipe!<br>Try again momentarily.', 5000, 'red');
            }
        });
    }

    function DeleteMultipleRecipes(selected) {
        // deletes multiple recipes
        var ids = selected;
        $.ajax({
            method: 'DELETE',
            url: '/admin/recipes' + '?deleteMultiple=true&ids=' + ids
        }).done(function(response) {
            DeleteRows(selected);
            Materialize.toast('Successfully deleted recipe', 5000, 'green');
        }).fail(function(jqXHR, textStatus, errorThrown) {
            var statusCode = (jqXHR.status.toString()).split('');
            var statusText = jqXHR.statusText;
            if(statusCode[0] === 5 || statusText.match(/Internal Server Error/)) {
                // server-side error - contact pablo
                Materialize.toast('Server-side Error - Was not able to delete. Contact Pablo if problem persists.', 5000, 'red');
            } else if(statusCode[0] === 4 || statusText.match(/Bad Request/)) {
                // client-side error - try again in a few moments
                Materialize.toast('Failed to Delete Recipe!<br>Try again momentarily.', 5000, 'red');
            }
        });
    }
</script>